export function apiProxy(y="",n={}){return new Proxy(async(o,...t)=>{let[h="",a={}]=typeof t[0]=="string"?t:["",t[0]||{}],d={...n,...a,path:y+h,method:(a.method??o).toUpperCase(),headers:{"Content-Type":"application/json",...n.headers,...a.headers}},p=d.middlewares||[];delete d.middlewares;const i=async e=>{for(const r of p)r.request&&(e=await r.request?.(e)||e);e.body&&typeof e.body!="string"&&(e.body=JSON.stringify(e.body));let s=await fetch(e.path,e);for(const r of p)r.response&&(s=await r.response?.(s,e,i)||s);return s};return i(d)},{get:(o,t)=>o.bind(void 0,t)})}
