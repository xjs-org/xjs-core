let h=!1;const{getPrototypeOf:S,entries:m}=Object,d=document,k=S({}),f=[],c=new Set,P=()=>{h=!1;for(const e of c)e();c.clear()},T=(e,n,r)=>{f.push({s:e,e:r});const t=n();return f.pop(),t},_=e=>{let n=e;const r=new Set;return{get value(){const t=f[f.length-1];return t&&r.add(t),n},set value(t){if(t!==n){n=t;for(const i of r){if(i.e&&i.e.nodeType&&!i.e.isConnected){r.delete(i);continue}c.add(i.s)}c.size>0&&!h&&(h=!0,queueMicrotask(P))}},isSignal:!0}},w=e=>e?.nodeType?e:new Text(e??""),q=(e,n)=>e.replaceChild(w(n),e.lastChild),b=(e,n,r)=>{if(typeof n=="function"||n?.isSignal){let t=n.isSignal?()=>n.value:n;return T(()=>e(r,t()),t,r)}return n},v=(e,...n)=>(n.flat(1/0).filter(r=>r).forEach(r=>{let t=b(q,r,e);if(Array.isArray(t))return t.map(i=>v(e,i));e.append(w(t))}),e),O=e=>{let n=e?d.createElementNS.bind(d,e):d.createElement.bind(d);return new Proxy((r,...t)=>{let i=t[0]||0,[x,...A]=S(i)===k?i.isSignal?[{},...t]:t:[{},...t],l=n(r);l.on=(a,o)=>l.addEventListener(a,o)||l;for(let[a,o]of m(x)){if(!o)continue;let E=S(o)===k&&!o.isSignal?(s,p)=>{let g=(u,y)=>l[s][u]=y;m(p).forEach(([u,y])=>g(u,b(g,y,u)))}:(s,p)=>s in l?l[s]=p:l.setAttribute.bind(l),C=a.startsWith("on")?o:b(E,o,a);E(a,C)}return v(l,A)},{get:(r,t)=>r.bind(void 0,t)})};export{v as append,O as html,_ as signal};
